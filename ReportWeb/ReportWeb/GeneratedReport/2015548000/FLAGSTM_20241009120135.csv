CREATE TEMPORARY TABLE report_data SELECT t.TrackNum , t.RTrackNum , IF(istOri.Code IS NOT NULL, CONCAT(istOri.Name,' (',istOri.Code,')')      , t.OriStore    ) AS OriStore  , IF(idcstaOri.Code IS NOT NULL, CONCAT(idcstaOri.Alias,' (',idcstaOri.Code,')' )      , IF(idpstaOri.Code IS NOT NULL, CONCAT(idpstaOri.Alias,' (',idpstaOri.Code,')' )          , IF(hubstaOri.Hub IS NOT NULL, CONCAT(hubstaOri.Alias,' (',hubstaOri.Hub,')' )              , IF(idcOri.Code IS NOT NULL, CONCAT(idcOri.Alias,' (',idcOri.Code,')' )                  , IF(idpOri.Code IS NOT NULL, CONCAT(idpOri.Alias,' (',idpOri.Code,')' )                      , IF(hubOri.Hub IS NOT NULL, CONCAT(hubOri.Alias,' (',hubOri.Hub,')' )                          , t.OriDC                        )                    )                )            )        )    ) AS OriDC  , IF(istDst.Code IS NOT NULL, CONCAT(istDst.Name,' (',istDst.Code,')')      , t.DstStore    ) AS DstStore  , IF(idcstaDst.Code IS NOT NULL, CONCAT(idcstaDst.Alias,' (',idcstaDst.Code,')' )      , IF(idpstaDst.Code IS NOT NULL, CONCAT(idpstaDst.Alias,' (',idpstaDst.Code,')' )          , IF(hubstaDst.Hub IS NOT NULL, CONCAT(hubstaDst.Alias,' (',hubstaDst.Hub,')' )              , IF(idcDst.Code IS NOT NULL, CONCAT(idcDst.Alias,' (',idcDst.Code,')' )                  , IF(idpDst.Code IS NOT NULL, CONCAT(idpDst.Alias,' (',idpDst.Code,')' )                      , IF(hubDst.Hub IS NOT NULL, CONCAT(hubDst.Alias,' (',hubDst.Hub,')' )                          , t.DstDC                        )                    )                )            )        )    ) AS DstDC  , CAST(tst.ReasonRetur AS CHAR) AS Reason , CAST(replace(replace(tst.Description, '
', ' '), '', ' ') AS CHAR) AS Description , CAST(s.StatusNew AS CHAR) AS LastStatus , CAST(h.TrackTime AS CHAR) AS TrackTime , CAST(h.OprId1 AS CHAR) AS UserId , CAST(h.OprName1 AS CHAR) AS UserName FROM TrackingHistory h INNER JOIN `Transaction` t ON (t.TrackNum = h.TrackNum) LEFT JOIN `Account` a ON (a.Account = t.ShAccount) LEFT JOIN indomaretstore_for_report istOri ON istOri.Code = t.OriStore  LEFT JOIN indomaretstore_for_report istDst ON istDst.Code = t.DstStore  LEFT JOIN indomaretdc idcstaOri ON idcstaOri.Code = t.OriStation  LEFT JOIN indomaretdepo idpstaOri ON idpstaOri.Code = t.OriStation  LEFT JOIN msthub hubstaOri ON hubstaOri.Hub = t.OriStation  LEFT JOIN indomaretdc idcOri ON idcOri.Code = t.OriDC  LEFT JOIN indomaretdepo idpOri ON idpOri.Code = t.OriDC  LEFT JOIN msthub hubOri ON hubOri.Hub = t.OriDC  LEFT JOIN indomaretdc idcstaDst ON idcstaDst.Code = t.DstStation  LEFT JOIN indomaretdepo idpstaDst ON idpstaDst.Code = t.DstStation  LEFT JOIN msthub hubstaDst ON hubstaDst.Hub = t.DstStation  LEFT JOIN indomaretdc idcDst ON idcDst.Code = t.DstDC  LEFT JOIN indomaretdepo idpDst ON idpDst.Code = t.DstDC  LEFT JOIN msthub hubDst ON hubDst.Hub = t.DstDC  LEFT JOIN msttrackingstatus s ON (h.`Status` = s.`Status`) LEFT JOIN transactionstmtracknum tst ON (tst.`tracknum` = t.`tracknum`) LEFT JOIN Tracking trc ON (h.`Tracknum` = trc.`Tracknum` AND trc.`Seqno` = h.`SeqNo` - 1 ) LEFT JOIN MstTrackingStatus strc ON (trc.`Status` = strc.`Status`) WHERE h.`Status` IN ('STM') AND h.TrackTime BETWEEN @param_SDate AND @param_EDate AND a.SellerCategory IN ('10')
